---
title: "Covid-analysis"
author: "Marek Holik"
format: html
editor: visual
reference-location: margin
citation-location: margin
toc: true
toc-depth: 2
toc-location: left
---

# Úvod do Problematiky

Pandémia COVID-19 mala významný vplyv na Indiu, pričom táto krajina (ako aj ostatné krajiny) zaznamenala veľký počet prípadov a úmrtí v dôsledku vírusu. Vzniklo obrovské množstvo údajov, ktoré taktiež nemusia súvisieť s vírusom samotným ale s aspektami každodenného života, obsahujúce napríklad dáta o ovzduší, vzdelávaní alebo ekonomií. Tieto dáta umožnili výskumníkom, analytikom a vedcom údajov získať prehľad a pochopiť vplyv vírusu na spoločnosť.

## Analýza dát a hypotézy

V tomto projekte budú predstavené súbory údajov a ich následna analýza. Datasety sú verejné a ľahko dostupné na internete a obsahujú informácie o potvrdených prípadoch, úmrtiach, testovaní, hospitalizáciách, očkovaniach a iných relevantných premenných na rôznych geografických úrovniach, ako sú globálne, a regionálne. Analýza týchto súborov údajov nám môže ukázať sledovať šírenie vírusu, identifikovať trendy a prispôsobiť dôležité rozhodnutia na základe týchto faktov. Zozbierané dáta sú z časového úseku január 2020 až Máj 2021, čiže vieme aj overiť, či boli naše pozorovania vývoju pandémie pravdivé alebo nie. 


```{r,echo = FALSE}
suppressWarnings({
    suppressMessages(library(readxl));
    suppressMessages(library(tidyr));
    suppressMessages(library(dplyr));
    suppressMessages(library(ggplot2));
    suppressMessages(library(plotly));
    suppressMessages(library(sf));
    suppressMessages(library(leaflet));
    suppressMessages(library(lubridate));
    suppressMessages(library(DT));
    suppressMessages(library(htmltools));
    suppressMessages(library(patchwork));
    suppressMessages(library(treemap));
})

```
```{r,echo = FALSE}
Clean_Vaccination_Dataset <- read.csv("datasets/2_covid_vaccine_statewise.csv") %>%
    rename("Muži" = "Male.Individuals.Vaccinated.", 
           "Ženy" = "Female.Individuals.Vaccinated.", 
           "Trans" = "Transgender.Individuals.Vaccinated.",
           "18-44" = "X18.44.Years.Individuals.Vaccinated.",
           "45-60" = "X45.60.Years.Individuals.Vaccinated.",
           "60+" = "X60..Years.Individuals.Vaccinated.",
           "Celkom_očkovaný" = "Total.Individuals.Vaccinated",
           "Štát" = "State",
           "Dátum" = "Updated.On",
           "Covaxin" = "Covaxin..Doses.Administered.",
           "CoviShield" = "CoviShield..Doses.Administered.",
           "Sputnik" = "Sputnik.V..Doses.Administered."
           ) %>% 
    mutate("Dátum" = dmy(Dátum)) %>%
    mutate("Dátum" = format(Dátum, "%Y-%m-%d")) %>%
    select("Dátum", "Štát", "Muži", "Ženy", "Trans", "18-44", "45-60", "60+", "Celkom_očkovaný", "Covaxin", "CoviShield","Sputnik")

India_Vaccination_Dataset <- Clean_Vaccination_Dataset[!is.na(Clean_Vaccination_Dataset$"Muži"),]

ALL_Vaccination_Dataset <- Clean_Vaccination_Dataset %>%
        select(-"Muži", -"Ženy", -"Trans", -"Covaxin", -"CoviShield", -"Sputnik") %>%
        filter(Štát != "India") %>%
        filter(complete.cases(Celkom_očkovaný))

rm(Clean_Vaccination_Dataset)

ALL_Testing_Dataset <- read.csv("datasets/2_Testing_Data.csv") %>%
    rename("Štát" = "State.UTs",
           "Počet_vakcinácií" = "Total.Vaccination.Doses",
           "Populácia_Štátu" = "Population") %>%
    select(-"Dose.1", -"Dose.2")
Raw_CovidTest_Dataset <- read.csv("datasets/2_StatewiseTestingDetails.csv") %>%
    rename("Dátum" = "Date",
           "Štát" = "State",
           "Počet_Testov" = "TotalSamples",
           "Negatívne" = "Negative",
           "Pozitívne" = "Positive") %>%
    select(-"Negatívne", -"Počet_Testov") %>%
    filter(complete.cases(Pozitívne)) %>%
    arrange(Dátum) 

Raw_CovidTest_Dataset$Dátum <- as.Date(Raw_CovidTest_Dataset$Dátum)

Raw_Covid_Dataset <- read.csv("datasets/2_covid_19_india.csv") %>%
    rename("Dátum" = "Date", 
           "Štát" = "State.UnionTerritory",
           "Indovia" = "ConfirmedIndianNational",
           "Celosvetovo" = "ConfirmedForeignNational",
           "Vyliečený" = "Cured",
           "Úmrtia" = "Deaths",
           "Potvrdené" = "Confirmed") %>%
    select(-"Sno", -"Time", -"Indovia", -"Celosvetovo")
    

Raw_Covid_Dataset$Dátum <- as.Date(Raw_Covid_Dataset$Dátum) - days(1)

ALL_Covid_Dataset <- merge(Raw_CovidTest_Dataset, Raw_Covid_Dataset, by=c("Dátum" = "Dátum", "Štát" = "Štát"), all = TRUE) %>%      
    select("Dátum", "Štát", "Vyliečený", "Úmrtia", "Potvrdené")

rm(Raw_Covid_Dataset, Raw_CovidTest_Dataset)

temp <- ALL_Covid_Dataset %>% aggregate(Potvrdené ~ Štát, FUN = max)
ALL_Testing_Dataset$Potvrdené_Prípady <- temp$Potvrdené[match(ALL_Testing_Dataset$Štát, temp$Štát)]
rm(temp)

```

## pozorovanie
```{r,fig.align='center',out.extra='angle=90',fig.show='hold', fig.width=4,fig.ncol=3,echo = FALSE}

nc <- st_read("India-map/India_State_Boundary.shp", quiet=TRUE)[-18,]
nc <- nc[order(nc$State_Name),]
nc$State_Name <- ALL_Testing_Dataset$Štát 
nc$Potvrdené <- ALL_Testing_Dataset$Potvrdené_Prípady
nc$Populácia <- ALL_Testing_Dataset$Populácia_Štátu
nc$Vakcinácie <- ALL_Testing_Dataset$Počet_vakcinácií
nc <- rename(nc, "Štát" = "State_Name")
nc$percento <- ALL_Testing_Dataset$Potvrdené_Prípady/ALL_Testing_Dataset$Populácia_Štátu
pot <- ggplot(nc) + 
    geom_sf(aes(fill=Potvrdené)) + 
    labs(title = "Prípady") + 
    scale_fill_viridis_c() + 
    theme(axis.title = element_blank(), 
          axis.text = element_blank(), 
          axis.ticks = element_blank(),
          legend.title = element_blank(),
          legend.position = "none",
          plot.title = element_text(hjust = 0.5))
pop <- ggplot(nc) + 
    geom_sf(aes(fill=Populácia)) + 
    labs(title = "Populácia") + 
    scale_fill_viridis_c() + 
    theme(axis.title = element_blank(), 
          axis.text = element_blank(), 
          axis.ticks = element_blank(),
          legend.title = element_blank(),
          legend.position = "none",
          plot.title = element_text(hjust = 0.5))
vak <- ggplot(nc) + 
    geom_sf(aes(fill=Vakcinácie)) + 
    labs(title = "Vakcinácie") + 
    scale_fill_viridis_c() + 
    theme(axis.title = element_blank(), 
          axis.text = element_blank(), 
          axis.ticks = element_blank(),
          legend.title = element_blank(),
          legend.position = "none",
          plot.title = element_text(hjust = 0.5))
par(mfrow=c(1,3))
pop 
vak 
pot

```
Uttar Pradesh je krajina s najväčšou populáciou s počtom 200 miliónov ľudí. Keďže je to oblasť s vysoko kvalitnou pôdou a ekonomicky výhodnými podmienkami pre obyvateľov, aj hustota populácie je zo všetkých štátov v Indií najväčšia, čo znamená, že mestské oblasti sú náchylnejšie na šírenie a prenosu vírusu.^[https://en.wikipedia.org/wiki/Uttar_Pradesh] Môžeme si všimnúť, že počet vakcinovaných ľudí je tiež najväčší, ale v tabuľke počtu nakazených ľudí je na šiestej priečke, kde bolo nakazených iba 7% celkovej populácie štátu. 

Krajina obdržala najväčší počet dávok vakcín - približne 300 miliónov, čo je vzhľadom na počet obyvateľov 130%, čiže väčšina obyvateľstva bola zaočkovaná a preto sa vírus v tejto krajine nešíril ako by sa predpokladalo. Na druhej strane krajina s najväčším počtom potvrdených prípadov je Maharashtra, ktorá podobne ako Uttar Pradesh má veľkú hustotu obyvateľstva, počet dávok je rovnako vysoko, okolo 125%. Mumbai, hlavné mesto Maharashtra, je najobývanejšie mesto v Indií s počtom obyvateľstva 20 miliónov. V centre sa nachádza taktiež najväčšie a najrušnejšie letisko Indie,Chhatrapati Shivaji Maharaj, s ročným obratom ľudí 48 miliónov, čiže potenciál šírenia vírus je veľmi vysoký. Taktiež ľudia neboli oboznámení s aktuálnymi protipandemickými opatreniami, keďže veľká časť obyvateľstva sú migrujúcich pracovníkov, ktorí prichádzajú z iných častí Indie za lepšími podmienkami.    

# Treemap
::: columns
::: {.column width="40%"}
```{r, fig.width=5,echo = FALSE}
group <- ALL_Testing_Dataset$Štát
value <- ALL_Testing_Dataset$Potvrdené_Prípady
data <- data.frame(group,value)
treemap(data, index="group", vSize="value", type="index")
rm(group, value, data)
```
:::

::: {.column width="60%"}
text
:::
:::

# Vývoj všetkých ochorenia
::: columns
::: {.column width="40%"}
```{r,fig.align='right',echo = FALSE}
new <- ALL_Covid_Dataset %>% group_by(Dátum) %>%
    summarize(cured = sum(Vyliečený),
              deaths = sum(Úmrtia),
              conf = sum(Potvrdené))
tail(new, 1)
new <- pivot_longer(new, cols = c(cured, deaths, conf), names_to = "Column", values_to = "Value")

new <- new[complete.cases(new),]
ggplot(new, aes(x = Dátum, y = Value, fill = Column)) +geom_area() +labs(x = "X", y = "Y") + theme_minimal()

```
:::

::: {.column width="60%"}
text
:::
:::
# kategorizácia

Aké je skúmané obdobie? Výsledky skúmaného obdobia, muži ženy trans muži 53 percent, ženy 46 percent

```{r,fig.align='center',out.extra='angle=90',fig.show='hold', fig.width=10,fig.ncol=1,echo = FALSE}
# doplniť ylabel
par(mfrow=c(1,3))
vect <-  as.matrix(select(tail(India_Vaccination_Dataset, 1), Muži, Ženy, Trans)) 
vect <- vect/ round(tail(India_Vaccination_Dataset$Celkom_očkovaný*100, 1), 2)
barplot(vect, beside = TRUE, col = c("blue", "pink", "orange"))

vect <-  as.matrix(select(tail(India_Vaccination_Dataset, 1), "18-44", "45-60", "60+")) 
vect <- vect/ round(tail(India_Vaccination_Dataset$Celkom_očkovaný*100, 1), 2)
barplot(vect, beside = TRUE, col = c("blue", "pink", "orange"))

vect <- as.matrix(select(tail(India_Vaccination_Dataset, 1), "Covaxin", "CoviShield", "Sputnik")) 
barplot(vect, beside = TRUE, col = c("blue", "pink", "orange"), ylab = "Number of Vaccines", yaxt="n")
rm(vect)

```

Veková reprezentácia 36 percent

# Percentuálna tabuľka populácie a nakazenia

# Zhrnutie
